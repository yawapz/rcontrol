---
### YAML syntax ###

# Идентификатор приложения в формате UUID
application:
    id: c075170a-adf0-45aa-9ada-4eaf8151b21b
    name: BoostPumpCtl
    line: 1

# Конфигурирование системы логирования
logger:
    # Уровень логирования. Допускаются следующие значения: error, warning, info,
    # verbose, debug, debug2. По умолчанию используется info.
    level: debug

    # Определяет будет ли пересоздаваться log-файл  при  перезапуске  программы
    # (флаг: true/false). Если параметр равен 'false', то log-файл будет  пере-
    # создаваться при каждом перезапуске программы, в противном случае  логиро-
    # вание будет выполняться в существующий файл.
    continue: true

    # Наименование файла логирования
    file: /var/opt/yamz/log/boostpumpctl.log

    # Определяет файл конфигурирования сейверов и фильтров для системы логирования
    conf: /etc/yamz/boostpumpctl.logger.conf

    filters:
        # Наименование фильтра
      - name: default
        type: module_name
        mode: exclude

        modules: [
            VideoCap,
            VideoJitter,
            DetectPump,
            Tracking,
        ]

# Конфигурирование внешних подключений
listener:
    # Определяет адрес для внешних подключений, задается в формате IPv4.  Можно
    # задавать два  предопределенных  значения:  any - допускается  подключение
    # с любого адреса (соответствует 0.0.0.0), и localhost - допускается подклю-
    # чение только с локального адреса (соответствует 127.0.0.1)
    address: any_ip4

    # Порт подключения
    port: 41121

# Параметры для подключения к пулу пользователей
users_pool:
    address: 127.0.0.1
    port: 62063

    # Пароль для подключения
    password: 760e9c6558c043528f4c8865c8d0542b

    # Таим-аут между попытками подключения (в секундах)
    reconnect_timeout: 60

# Настройки состояния приложения
state:
    file: /var/opt/yamz/state/boostpumpctl.state

# Настройки для моделей
model:
    #file: det_yolov7_yamz_boostpump_640_640_3_static_v20231107.onnx
    #file: det_yolov7_yamz_boostpump_640_640_3_static_v20231130.onnx
    file: det_yolov7_yamz_boostpump_640_640_3_static_v20231228.onnx
    threshold: {cutting: 0.20, nms: 0.45}

tracking:
    base:
        score: 0.70
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 500, saturate: 5}

    table:
#    	a: ~
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 500, saturate: 5}

    retainer:
        score: 0.80
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 500, saturate: 8}

    body:
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 500, saturate: 5}

    gear:
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 100, saturate: 5}

    axis:
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 100, saturate: 5}

    gasket:
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 100, saturate: 5}

    marker:
        score: 0.3
        threshold:  {iou: 0.3, ttl: 20}
        validation: {time: 500, saturate: 5}

    cap:
        score: 0.50
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 10, saturate: 2}

    noise:
        threshold:  {iou: 0.3, ttl: 8}
        validation: {time: 100, saturate: 5}


# Устройство с которого происходит считывание видео потока
device0:
    # Определяет с какого типа устройства будет производиться захват видео-потока.
    # Допускаются значения:
    #   daheng   - захват потока с камеры Daheng
    #   file     - получение потока из файлов, см. секцию 'file'
    type: daheng
    #type: file

    # Количество попыток подключения к источнику видеоконтента.  Интервал между
    # попытками 1 минута. Если по достижении указанного количества попыток  так
    # и не получится подключиться к устройству, то приложение будет остановлено.
    # В случае если программа находится под управлением системы systemd  данное
    # приложение будет перезапущено. Таким  образом  осуществляется  перезапуск
    # программы в случае некорректной программой инициализации видеоустройства.
    # Если  значение  параметра  меньше 1,  то  количество  попыток  считается
    # неограниченным.
    connect_attempts: 5

    # Секция воспроизведения видео-потока
    #stream: http://root:1234@192.168.11.47/mjpg/video.mjpg
    #stream: rtsp://root:1234@192.168.11.47:554/axis-media/media.amp?videocodec=h264
    #stream: http://89.240.27.152:1024/mjpg/video.mjpg

    # Секция воспроизведения файлов
    file:
        # Параметр  определяет, что файлы должны воспроизводиться циклично.
        cycle: true

        # Список файлов для воспроизведения
        items: [
            #/var/video/binnopharm/2023-01-23_8-00-29_cut4.avi,
            #/var/video/erg/promovideo1.avi,
            #/var/video/uraltrubprom/video_1.mp4,
            #/var/opt/yamz/video/2023.09.27_13.08.32.avi,
            #/var/opt/yamz/video/no_gasket.avi,
            #/var/opt/yamz/video/normal2.avi,
        ]

    daheng:
        #--- Статические параметры ---

        # Режим открытия daheng-устройства. Может принимать следующие значения:
        #   index  - числовой идентификатор устройства внутри daheng-драйвера
        #            (начинается с 1);
        #   serial - серийный номер устройства;
        #   ip     - ip-адрес устройства (для GigE камер)
        #   mac    - mac-адрес устройства (для GigE камер)
        open_mode: serial

        # Строка подключения к daheng-устройству. Значение open_content зависит
        # от параметра open_mode
        open_content: FCQ23060601

        # Преобразует захваченное с камеры изображение в формат RGB
        convert_rgb: false

        # Битность данных. Допускается задавать значения Mono8, Mono12,
        # BayerRG8, BayerRG12 остальные значения на данный момент игнорируются
        pixel_format: BayerRG8

        # Размер Jumbo Frame
        mtu: 8192

        #--- Динамические параметры ---

        # Режим автонастройки экспозиции. Допускаются значения:
        #   off  - автонастройка отключена;
        #   continuous - непрерывная настройка
        exposure_auto: off

        # Время экспозиции (в микросекундах). Параметр учитывается
        # когда exposure_auto равно off
        exposure_time: 50000

        # Параметр включает принудительное ограничение по fps (флаг: true/false).
        # Когда параметр включен (true) текущее значение fps не будет превышать
        # величину fps_limit
        require_fps_limit: false

        # Числовое ограничение текущего значения fps. Параметр работает, когда
        # require_fps_limit включен
        fps_limit: 6

        # Усиление (в dB)
        gain: 0

        # Режим автонастройки баланса белого. Допускаются значения:
        #   off  - автонастройка отключена;
        #   continuous - непрерывная настройка
        balance_white_auto: off

        # Параметр включает ручную настройку насыщения цвета (флаг: true/false).
        # Когда параметр включен (true) уровень цветового насыщения будет опре-
        # деляться значением параметра saturation
        saturation_mode: true

        # Уровень цветового насыщения
        saturation: 64

        # Пресет источника света. Допускаются значения:
        #   daylight_6500k
        #   daylight_5000k
        #   cool_white_fluorescence
        #   inca
        light_source_preset: daylight_6500k

    # Параметр позволяет ограничить  количество  кадров  считываемых  с  видео-
    # устройства. Некоторые потоковые видеоустройства способны выдавать более 25
    # fps (влоть до 50 fps). Большое количество fps может  негативно  сказаться
    # на потребляемых программой вычислительных ресурсах. Рекомендуется устанав-
    # ливать данный параметр не выше 30 fps. Параметр  игнорируется  для  камер
    # машинного зрения, у них есть собственные механизмы ограничения fps
    fps_limit: 40

    # Для некоторых видео контейнеров невозможно корректно определить количество
    # fps. Параметр позволяет определять fps средствами самой программы.
    # Примечание: Этот параметр имеет смысл только для устройств с типом 'file',
    # для устройств с типами 'webcam', 'stream' количество  fps  всегда  опреде-
    # ляется средствами самой программы
    force_detect_fps: false

    # Отражает по горизонтали кадры входящего видеопотока
    mirror_frame: true

# Параметры подключения к базе данных
database:
    address:    127.0.0.1
    port:       5432
    user:       postgres
    password:   postgres
    name:       yamz
    options:    "connect_timeout=5;"
    main_table: tnvd
    # Очистка устаревших записей (значение в часах)
    clear_interval: 1

# Отображает время обработки фреймов на кадре, используется для оценки задержки
# получения видео-кадров с камеры
show_debug_time: false

save_video:
    # Максимальное время записи видео (в минутах).
    max_time: 30

    # Директория для сохранения видео
    path: /var/opt/yamz/video
save_images:
    # Директория для сохранения фото
    path: /var/opt/yamz/images

    # Индексы реле
relay:
    green:  1
    yellow: 2
    red:    3
    siren:  4
    wrench: 5

    # Длительность звучания сирена (в секундах)
    siren_duration: 2

    # Интервал опроса статусов с реле (в секундах)
    status_request: 2

line_control:
    # Динамический ROI (ROI будет завязан на рамку корпуса) // требуется перезапуск программы
    dynamic_roi: true
    # Область интереса (формат [x, y, x2, y2]) 
    # Буфферная зона - первичная обрезка помех по координатам, отсечение помех фотографирования, автосброс
    # Размечать не меньше размера подставки!
    #roi: [500, 200, 2500, 1700]
    roi: [0, 0, 3088, 2000]


# Число рамок пустой подставки для автозаврешения сборки
final_frame_count: 80

# Активация кнопки начала сборки debug
debug_start: true

# Конфигурация сканера при инициализации
scanner:
    # Флаг = true, то принудительно параметры baud и bits не будут установлены
    auto_baud: false

    # Допустимые значения baud
    #    1200
    #    2400
    #    4800
    #    9600
    #    19200
    #    38400
    #    57600
    #    115200
    baud: 115200
    
    # Допустимые значения bits
    #    5
    #    6
    #    7
    #    8
    bits: 8
...
